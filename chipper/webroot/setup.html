<!DOCTYPE html>
<html>

<head>
  <title>Wire-Pod Setup</title>
  <!-- Meta Apple tags for a PWA like experience. -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#1e1e1e">
  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://kit.fontawesome.com/7508f396ac.js" crossorigin="anonymous"></script>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="Thu, 01 Jan 1970 00:00:00 GMT">
</head>

<body>
  <div id="outer">
    <div id="content" class="">
      <h1>Wire-Pod Setup</h1>
      <hr />
      <div class="main-nav-parent">
        <div class="main-nav-child">
          <a href="index.html"><i class="fa-solid fa-reply"></i><br />Back</a>
        </div>
        <div class="main-nav-child">
          <a href="#" onclick="showWeather(); return false;"><i class="fa solid fa-cloud-sun" id="icon-Weather"
              name="icon"></i><br />Weather</a>
        </div>
        <div class="main-nav-child">
          <a href="#" onclick="showKG(); return false;"><i class="fa solid fa-diagram-project" id="icon-KG"
              name="icon"></i><br />Knowledge Graph</a>
        </div>
        <div class="main-nav-child">
          <a href="#" onclick="showLanguage(); return false;"><i class="fa-solid fa-language" id="icon-Language"
              name="icon"></i><br />Set Language</a>
        </div>
        <!--<div class="main-nav-child"><a href="#" onclick="showRestart(); return false;"><i class="fa solid fa-arrow-rotate-right" id="icon-Restart" name="icon"></i><br/>Restart Wire-Pod</a></div> -->
      </div>
      <hr />

      <div id="section-weather" style="display: none">
        <h3>Weather API Setup</h3>
        <hr class="small-hr">
        <div>
          <p>Set the weather provider you'd like to use.</p>
          <hr class="small-hr">
          <div id="addWeatherProviderAPI"></div>
          <form id="weatherAPIAddForm">
            <label for="weatherProvider">Weather API Provider:</label>
            <select name="weatherProvider" id="weatherProvider" form="weatherAPIAddForm" onchange="checkWeather()">
              <option value="" selected>None</option>
              <option value="openweathermap.org">
                OpenWeatherMap
              </option>
              <option value="weatherapi.com">WeatherAPI</option>
            </select><br />
            <span id="apiKeySpan" style="display: none">
              <label for="apiKey">API Key:</label><br />
              <input class="tinput" type="text" name="apiKey" id="apiKey" /><br />
            </span>
          </form>
          <hr class="small-hr">
          <button onclick="sendWeatherAPIKey()">
            Apply Weather Settings
          </button>
          <div id="addWeatherProviderAPIStatus"></div>
          <hr />
        </div>
      </div>

      <div id="section-kg" style="display: none">
        <h3>Knowledge Graph Setup</h3>
        <hr class="small-hr">
        <div>
          <p>Select the knowledge provider you would like to use, then enter the required information.</p>
          <hr class="small-hr">
          <div id="addKGProviderAPI"></div>
          <form id="kgAPIAddForm">
            <label for="kgProvider">Knowledge Graph API Provider:</label>
            <select name="kgProvider" id="kgProvider" form="kgAPIAddForm" onchange="checkKG()">
              <option value="" selected>None</option>
              <option value="openai">OpenAI</option>
              <option value="xiaozhi">Xiaozhi</option>
              <option value="houndify">Houndify</option>
              <option value="together">Together</option>
              <option value="custom">Custom</option>
            </select>
            <span id="houndifyInput" style="display: none">
              <small class="desc">To use Houndify, create an account at
                <a href="https://www.houndify.com/signup">houndify.com</a>,
                create a free domain, and enter the Client ID and Key
                here.</small><br />
              <label for="houndID">Houndify Client ID:</label>
              <input type="text" name="houndID" id="houndID" /><br />
              <label for="houndKey">Houndify Client Key:</label>
              <input type="text" name="houndKey" id="houndKey" /><br />
            </span>
            <span id="togetherInput" style="display: none">
              <small class="desc">To use Together, create an account at
                <a href="https://www.together.xyz">together.com</a>, create
                a free domain, and enter the Model Name and Together Key
                here.</small><br />
              <label for="togetherModel">Together Model Name: <small class="desc">(leave blank for default
                  meta-llama/Llama-3-70b-chat-hf)</small></label>
              <input type="text" name="togetherModel" id="togetherModel" /><br />
              <label for="togetherKey">Together Key:</label>
              <input type="text" name="togetherKey" id="togetherKey" /><br />
              <label for="togetherAIPrompt">GPT Prompt <small class="desc">(leave blank for
                  default):</small></label><br />
              <small><label class="desc" for="togetherAIPrompt">(default: "You are a helpful, animated robot called
                  Vector. Keep the response concise yet
                  informative.")</label></small>
              <input type="text" name="togetherAIPrompt" id="togetherAIPrompt" /><br />
            </span>
            <span id="openAIInput" style="display: none">
              <label for="openaiKey">OpenAI Key:</label>
              <input type="text" name="openaiKey" id="openaiKey" /><br />
              <label for="openaiKey">GPT Prompt <small class="desc">(leave blank for default):</small></label><br />
              <small><label class="desc" for="openAIPrompt">(default: "You are a helpful, animated robot called
                  Vector. Keep the response concise yet
                  informative.")</label></small>
              <input type="text" name="openAIPrompt" id="openAIPrompt" /><br />
              <label for="openaiVoice">OpenAI TTS voice for non-English languages:</label><br />
              <small class="desc">See <a target="_blank"
                  href="https://platform.openai.com/docs/guides/text-to-speech/voice-options">OpenAI's TTS site</a> to
                demo each voice.</small><br />
              <select name="openaiVoice" id="openaiVoice">
                <option value="fable" selected>Fable</option>
                <option value="alloy">Alloy</option>
                <option value="echo">Echo</option>
                <option value="onyx">Onyx</option>
                <option value="nova">Nova</option>
                <option value="shimmer">Shimmer</option>
              </select>
            </span>
            <span id="xiaozhiInput" style="display: none">
              <small class="desc">Xiaozhi provides real-time voice conversation with your Vector robot. Audio will be played through the robot's speaker.</small><br />
              <label for="xiaozhiBaseURL">Xiaozhi Base URL <small class="desc">(leave blank for default: wss://api.tenclass.net/xiaozhi/v1/)</small>:</label>
              <input type="text" name="xiaozhiBaseURL" id="xiaozhiBaseURL" placeholder="wss://api.tenclass.net/xiaozhi/v1/" /><br />
              <label for="xiaozhiDeviceID">Device ID (MAC Address) <small class="desc">(MAC address c·ªßa thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c pair v·ªõi server xiaozhi, v√≠ d·ª•: 6c:24:08:9e:ca:ee)</small>:</label>
              <input type="text" name="xiaozhiDeviceID" id="xiaozhiDeviceID" placeholder="6c:24:08:9e:ca:ee" style="font-family: monospace;" /><br />
              <label for="xiaozhiClientID">Client ID (UUID) <small class="desc">(Client ID ƒë·ªÉ x√°c ƒë·ªãnh client, v√≠ d·ª•: e8c9b0b3-350f-406d-a31c-7b87be097881)</small>:</label>
              <input type="text" name="xiaozhiClientID" id="xiaozhiClientID" placeholder="e8c9b0b3-350f-406d-a31c-7b87be097881" style="font-family: monospace;" /><br />
              <small class="desc" style="color: #666;">MAC address n√†y s·∫Ω ƒë∆∞·ª£c g·ª≠i trong headers khi s·ª≠ d·ª•ng TTS/STT c·ªßa xiaozhi. ƒêi·ªÅn MAC address c·ªßa thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c pair v·ªõi server xiaozhi.</small><br />
              <label for="xiaozhiVoice">Xiaozhi TTS Voice:</label><br />
              <small class="desc">Voice used for text-to-speech responses.</small><br />
              <select name="xiaozhiVoice" id="xiaozhiVoice">
                <option value="fable" selected>Fable</option>
                <option value="alloy">Alloy</option>
                <option value="echo">Echo</option>
                <option value="onyx">Onyx</option>
                <option value="nova">Nova</option>
                <option value="shimmer">Shimmer</option>
              </select>
            </span>

            <span id="customAIInput" style="display: none">
              <small class="desc">All LLM hosts that have OpenAI API compatibility are supported. For advanced
                users.</small><br />
              <label for="customKey">API Key <small class="desc">(for ollama, this is just 'ollama')</small>:</label>
              <input type="text" name="customKey" id="customKey" /><br />
              <label for="customAIEndpoint">API Endpoint <small class="desc">(i.e.
                  http://localhost:11434/v1)</small>:</label>
              <input type="text" name="customAIEndpoint" id="customAIEndpoint" /><br />
              <label for="customModel">LLM Model Name <small class="desc">(i.e. 'llama3')</small>:</label>
              <input type="text" name="customModel" id="customModel" /><br />
              <label for="customAIPrompt">LLM Prompt <small class="desc">(leave blank for
                  default)</small>:</label><br />
              <small><label class="desc" for="customAIPrompt">(default: "You are a helpful, animated robot called
                  Vector. Keep the response concise yet
                  informative.")</label></small>
              <input type="text" name="customAIPrompt" id="customAIPrompt" /><br />
            </span>

            <div style="text-align: left;">
              <span id="intentGraphInput" style="display: none;">
                <input type="checkbox" id="intentyes" name="intentgselect" onclick="checkKG()" />
                <label class="checkbox-label" for="intentyes">
                  Enable intent-graph. This
                  forwards the request to the LLM if the regular intent
                  processor didn't understand what you said.
                </label>
              </span>
              <span id="llmCommandInput" style="display: none">
                <input type="checkbox" id="commandYes" name="commandDoselect" />
                <label class="checkbox-label" for="commandYes">
                  Allow the LLM to make the robot perform animations and other actions during the response.
                </label>
              </span>
              <span id="saveChatInput" style="display: none">
                <input type="checkbox" id="saveChatYes" name="saveChatselect" />
                <label class="checkbox-label" for="saveChatYes">
                  Enable conversations via "I have a question". This also allows previous chats to be used in the
                  context of future responses. LLM actions (the box above this one) must be enabled for conversations to work.
                </label></br>
                <a href="#" onclick="deleteSavedChats()">Delete Saved Chats</a>
              </span>
              <span id="openAIVoiceForEnglishInput" style="display: none">
                <input type="checkbox" id="voiceEnglishYes" name="voiceEnglishselect" />
                <label class="checkbox-label" for="voiceEnglishYes">
                  Use the OpenAI TTS voice for English as well.
                </label>
              </span>
            </div>

          </form>
        </div>
        <hr class="small-hr">
        <button onclick="sendKGAPIKey()">Apply Settings</button>
        <div id="addKGProviderAPIStatus"></div>
        <hr class="small-hr">
        
        <!-- Xiaozhi Pairing Section -->
        <h3 style="margin-top: 20px;">üîó Xiaozhi Device Pairing</h3>
        <hr class="small-hr">
        <div>
          <!-- Progress Steps UI -->
          <div id="pairingStepsContainer" style="margin: 20px 0; padding: 20px; background-color: #f5f5f5; border-radius: 8px; border: 2px solid #e0e0e0;">
            <h4 style="color: #333; margin-bottom: 20px;">üìã Quy tr√¨nh Pairing (4 b∆∞·ªõc)</h4>
            
            <!-- B∆∞·ªõc 1: Ch·ªçn MAC Address -->
            <div id="step1" class="pairing-step" style="margin-bottom: 20px; padding: 15px; background-color: white; border-radius: 5px; border-left: 4px solid #e0e0e0;">
              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <div class="step-number" style="width: 30px; height: 30px; border-radius: 50%; background-color: #e0e0e0; color: #666; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">1</div>
                <h5 style="margin: 0; color: #999;">L·∫•y v√† Ch·ªçn MAC Address</h5>
                <span id="step1Status" class="step-status" style="margin-left: auto; padding: 5px 10px; border-radius: 15px; font-size: 12px; background-color: #e0e0e0; color: #666;">‚è≥ ƒêang ch·ªù</span>
              </div>
              <div id="step1Content" style="margin-left: 40px;">
                <button id="loadMACAddressBtn" onclick="loadMACAddressesToSelect()" 
                        style="padding: 10px 20px; background-color: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-bottom: 15px;">
                  üîç L·∫•y MAC Address
                </button>
                <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                  Nh·∫•n n√∫t "L·∫•y MAC Address" ƒë·ªÉ t·∫£i danh s√°ch MAC addresses c√≥ s·∫µn, sau ƒë√≥ ch·ªçn MAC address c·ªßa m√°y b·∫°n mu·ªën pair.
                </p>
                <div id="macAddressSelectContainer" style="display: none;">
                  <label for="macAddressSelect" style="display: block; margin-bottom: 8px; font-weight: bold; color: #333;">
                    Ch·ªçn MAC Address:
                  </label>
                  <select id="macAddressSelect" style="padding: 8px; width: 100%; max-width: 500px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;" onchange="onMACAddressSelected()">
                    <option value="">-- Ch·ªçn MAC Address --</option>
                  </select>
                  <p style="font-size: 12px; color: #666; margin-top: 8px; margin-bottom: 0;">
                    MAC address ƒë√£ ch·ªçn s·∫Ω ƒë∆∞·ª£c d√πng ƒë·ªÉ generate pairing code.
                  </p>
                </div>
                <div id="selectedMACInfo" style="margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 5px; display: none;">
                  <p style="margin: 0 0 8px 0; color: #2e7d32; font-size: 12px;">
                    ‚úÖ ƒê√£ ch·ªçn MAC Address: <code style="background: white; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-weight: bold;">-</code>
                  </p>
                  <div id="selectedClientIdInfo" style="margin-top: 8px; padding: 8px; background-color: #e3f2fd; border-radius: 3px; display: none;">
                    <p style="margin: 0; color: #1976d2; font-size: 11px;">
                      üÜî Client-Id (UUID): <code style="background: white; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-weight: bold; color: #1976d2;">-</code>
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- B∆∞·ªõc 2: Generate Pairing Code -->
            <div id="step2" class="pairing-step" style="margin-bottom: 20px; padding: 15px; background-color: white; border-radius: 5px; border-left: 4px solid #e0e0e0;">
              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <div class="step-number" style="width: 30px; height: 30px; border-radius: 50%; background-color: #e0e0e0; color: #666; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">2</div>
                <h5 style="margin: 0; color: #999;">Generate Pairing Code</h5>
                <span id="step2Status" class="step-status" style="margin-left: auto; padding: 5px 10px; border-radius: 15px; font-size: 12px; background-color: #e0e0e0; color: #666;">‚è≥ ƒêang ch·ªù</span>
              </div>
              <div id="step2Content" style="margin-left: 40px;">
                <button id="generatePairingCodeBtn" onclick="generateXiaozhiPairingCode()" 
                        style="padding: 10px 20px; background-color: #9e9e9e; color: white; border: none; border-radius: 5px; cursor: not-allowed; font-size: 16px;"
                        disabled>
                  üîë Generate Pairing Code
                </button>
                <p style="font-size: 12px; color: #999; margin-top: 5px; margin-bottom: 0;">
                  Vui l√≤ng ho√†n th√†nh b∆∞·ªõc 1 tr∆∞·ªõc.
                </p>
                <div id="pairingCodeDisplay" style="margin-top: 15px; padding: 20px; background-color: #e3f2fd; border-radius: 5px; display: none;">
                  <h4 style="color: #1976d2; margin-bottom: 10px;">üéØ M√£ Pairing c·ªßa b·∫°n:</h4>
                  <div id="pairingCode" style="font-size: 48px; font-weight: bold; color: #1976d2; letter-spacing: 10px; margin: 20px 0; text-align: center; font-family: monospace;">
                  </div>
                  <div id="clientIdDisplay" style="margin-top: 20px; padding: 15px; background-color: #fff; border-radius: 5px; border: 2px solid #1976d2;">
                    <p style="margin: 0 0 8px 0; color: #1976d2; font-weight: bold; font-size: 14px;">üÜî Client-Id (UUID):</p>
                    <div id="clientIdValue" style="font-size: 16px; font-family: monospace; color: #1976d2; word-break: break-all; padding: 8px; background-color: #e3f2fd; border-radius: 3px;">
                      ƒêang t·∫£i...
                    </div>
                    <p style="margin: 8px 0 0 0; color: #666; font-size: 11px;">
                      üí° Client-Id ƒë∆∞·ª£c t·ª± ƒë·ªông t·∫°o v√† l∆∞u v√†o config (gi·ªëng ESP32). Client-Id n√†y s·∫Ω ƒë∆∞·ª£c g·ª≠i k√®m trong t·∫•t c·∫£ c√°c request ƒë·∫øn Xiaozhi server.
                    </p>
                  </div>
                  <div id="pairingCodeInfo" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
                </div>
              </div>
            </div>

            <!-- B∆∞·ªõc 3: Nh·∫≠p code v√†o ESP32 -->
            <div id="step3" class="pairing-step" style="margin-bottom: 20px; padding: 15px; background-color: white; border-radius: 5px; border-left: 4px solid #e0e0e0;">
              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <div class="step-number" style="width: 30px; height: 30px; border-radius: 50%; background-color: #e0e0e0; color: #666; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">3</div>
                <h5 style="margin: 0; color: #999;">Nh·∫≠p code v√†o ESP32</h5>
                <span id="step3Status" class="step-status" style="margin-left: auto; padding: 5px 10px; border-radius: 15px; font-size: 12px; background-color: #e0e0e0; color: #666;">‚è≥ ƒêang ch·ªù</span>
              </div>
              <div id="step3Content" style="margin-left: 40px;">
                <div style="padding: 15px; background-color: #fff3e0; border-radius: 5px; border: 1px solid #ffb74d;">
                  <p style="margin: 0 0 10px 0; color: #e65100; font-weight: bold;">üì± H∆∞·ªõng d·∫´n:</p>
                  <ol style="margin: 0; padding-left: 20px; color: #666; font-size: 14px; line-height: 1.8;">
                    <li>M·ªü thi·∫øt b·ªã ESP32 Xiaozhi c·ªßa b·∫°n (ho·∫∑c PC ƒëang ch·∫°y code ESP32)</li>
                    <li>Thi·∫øt b·ªã s·∫Ω t·ª± ƒë·ªông g·ªçi <code style="background: #fff; padding: 2px 6px; border-radius: 3px;">/api/xiaozhi_check_version</code> v√† nh·∫≠n activation code</li>
                    <li>M√£ 6 ch·ªØ s·ªë s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã tr√™n m√†n h√¨nh ESP32</li>
                    <li>Nh·∫≠p m√£ ƒë√≥ v√†o thi·∫øt b·ªã (n·∫øu ESP32 y√™u c·∫ßu nh·∫≠p th·ªß c√¥ng)</li>
                    <li>Thi·∫øt b·ªã s·∫Ω t·ª± ƒë·ªông k·∫øt n·ªëi v·ªõi MAC address/Device-Id c·ªßa n√≥</li>
                  </ol>
                  <p style="margin: 10px 0 0 0; color: #ff9800; font-size: 12px;">
                    <strong>üí° L∆∞u √Ω:</strong> N·∫øu PC k·∫øt n·ªëi m√† kh√¥ng c√≥ MAC address, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o Device-Id t·ª´ IP address (b·∫Øt ƒë·∫ßu b·∫±ng "pc_")
                  </p>
                </div>
              </div>
            </div>

            <!-- B∆∞·ªõc 4: ESP32 t·ª± ƒë·ªông activate -->
            <div id="step4" class="pairing-step" style="margin-bottom: 20px; padding: 15px; background-color: white; border-radius: 5px; border-left: 4px solid #e0e0e0;">
              <div style="display: flex; align-items: center; margin-bottom: 10px;">
                <div class="step-number" style="width: 30px; height: 30px; border-radius: 50%; background-color: #e0e0e0; color: #666; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px;">4</div>
                <h5 style="margin: 0; color: #999;">ESP32 t·ª± ƒë·ªông activate</h5>
                <span id="step4Status" class="step-status" style="margin-left: auto; padding: 5px 10px; border-radius: 15px; font-size: 12px; background-color: #e0e0e0; color: #666;">‚è≥ ƒêang ch·ªù</span>
              </div>
              <div id="step4Content" style="margin-left: 40px;">
                <div style="padding: 15px; background-color: #e8f5e9; border-radius: 5px; border: 1px solid #81c784;">
                  <p style="margin: 0; color: #2e7d32; font-size: 14px;">
                    ‚úÖ Sau khi nh·∫≠p code, ESP32 s·∫Ω t·ª± ƒë·ªông:
                  </p>
                  <ul style="margin: 10px 0 0 0; padding-left: 20px; color: #666; font-size: 14px; line-height: 1.8;">
                    <li>T√≠nh HMAC-SHA256 c·ªßa challenge</li>
                    <li>G·ª≠i activation request ƒë·∫øn <code style="background: #fff; padding: 2px 6px; border-radius: 3px;">/api/xiaozhi_activate</code></li>
                    <li>Nh·∫≠n token v√† k·∫øt n·ªëi th√†nh c√¥ng</li>
                  </ul>
                </div>
                <div id="activationStatus" style="margin-top: 15px; padding: 15px; background-color: #f5f5f5; border-radius: 5px; display: none;">
                  <!-- Tr·∫°ng th√°i activation s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
              </div>
            </div>
          </div>

          <div id="xiaozhiPairingStatus"></div>
          
          <!-- Section ch·ªçn MAC address -->
          <div style="margin: 20px 0; padding: 15px; background-color: #f9f9f9; border-radius: 5px; border: 1px solid #ddd;">
            <label for="macAddressSelect" style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">
              üìç B∆∞·ªõc 1: Ch·ªçn MAC Address
            </label>
            <select id="macAddressSelect" style="padding: 8px; width: 100%; max-width: 500px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;" onchange="onMACAddressSelected()">
              <option value="">ƒêang t·∫£i MAC addresses...</option>
            </select>
            <p style="font-size: 12px; color: #666; margin-top: 8px;">
              <strong>L∆∞u √Ω:</strong> Ch·ªçn MAC address c·ªßa m√°y b·∫°n mu·ªën pair. MAC address ƒë√£ ch·ªçn s·∫Ω ƒë∆∞·ª£c d√πng ƒë·ªÉ generate pairing code.
            </p>
            <div id="selectedMACInfo" style="margin-top: 10px; padding: 10px; background-color: #e8f5e9; border-radius: 5px; display: none;">
              <p style="margin: 0; color: #2e7d32; font-size: 12px;">
                ‚úÖ ƒê√£ ch·ªçn: <code style="background: white; padding: 2px 6px; border-radius: 3px; font-family: monospace; font-weight: bold;">-</code>
              </p>
            </div>
          </div>
          
          <!-- N√∫t Generate Pairing Code -->
          <div style="margin: 20px 0;">
            <button id="generatePairingCodeBtn" onclick="generateXiaozhiPairingCode()" 
                    style="padding: 10px 20px; background-color: #4285f4; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;"
                    disabled>
              üìç B∆∞·ªõc 2: Generate Pairing Code
            </button>
            <p style="font-size: 12px; color: #999; margin-top: 5px;">
              Vui l√≤ng ch·ªçn MAC address ·ªü tr√™n tr∆∞·ªõc khi generate pairing code.
            </p>
          </div>
          <div id="pairingStatusCheck" style="margin-top: 10px; padding: 10px; background-color: #f5f5f5; border-radius: 5px; display: none;">
            <!-- Tr·∫°ng th√°i pairing s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
          </div>
          <div id="pairingCodeDisplay" style="margin-top: 20px; display: none;">
            <h4 style="color: #0f9d58;">Your Pairing Code:</h4>
            <div id="pairingCode" style="font-size: 48px; font-weight: bold; color: #4285f4; letter-spacing: 10px; margin: 20px 0;">
            </div>
            <p style="color: #666; font-size: 14px;"><strong>H∆∞·ªõng d·∫´n:</strong></p>
            <ol style="color: #666; font-size: 14px; margin-left: 20px; line-height: 1.8;">
              <li>Nh·∫≠p m√£ 6 ch·ªØ s·ªë n√†y v√†o thi·∫øt b·ªã ESP32 Xiaozhi c·ªßa b·∫°n (ho·∫∑c PC ƒëang ch·∫°y code ESP32)</li>
              <li>Thi·∫øt b·ªã s·∫Ω t·ª± ƒë·ªông k·∫øt n·ªëi v·ªõi MAC address/Device-Id c·ªßa n√≥</li>
              <li>N·∫øu PC k·∫øt n·ªëi m√† kh√¥ng c√≥ MAC address, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o Device-Id t·ª´ IP address</li>
              <li>M√£ n√†y s·∫Ω h·∫øt h·∫°n sau 10 ph√∫t</li>
            </ol>
            <p style="color: #ff9800; font-size: 12px; margin-top: 10px;">
              <strong>L∆∞u √Ω:</strong> N·∫øu b√°o "thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c th√™m", c√≥ th·ªÉ MAC address c·ªßa thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c l∆∞u trong server xiaozhi t·ª´ l·∫ßn pair tr∆∞·ªõc. 
              H√£y li√™n h·ªá admin server xiaozhi ƒë·ªÉ x√≥a device ho·∫∑c ki·ªÉm tra log ƒë·ªÉ xem MAC address.
            </p>
            <div id="pairingCodeInfo" style="margin-top: 10px; font-size: 12px; color: #999;"></div>
          </div>
          
          <!-- Section hi·ªÉn th·ªã MAC address c·ªßa m√°y ƒëang ch·∫°y code -->
          <div style="margin-top: 30px; padding: 20px; background-color: #fff3e0; border-radius: 5px; border: 2px solid #ff9800;">
            <h4 style="color: #e65100; margin-bottom: 15px;">üñ•Ô∏è MAC Address c·ªßa m√°y ƒëang ch·∫°y code</h4>
            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
              MAC address c·ªßa m√°y t√≠nh ƒëang ch·∫°y wirepodxiaozhi server (PC c·ªßa b·∫°n):
            </p>
            <button onclick="loadLocalMACAddress()" style="padding: 8px 15px; background-color: #ff9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin-bottom: 15px;">
              üîÑ L·∫•y MAC Address
            </button>
            <div id="localMACDisplay" style="margin-top: 10px; padding: 15px; background-color: white; border-radius: 5px; display: none;">
              <!-- MAC address s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
          </div>

          <!-- Section ki·ªÉm tra tr·∫°ng th√°i pairing -->
          <div style="margin-top: 30px; padding: 20px; background-color: #e8f5e9; border-radius: 5px; border: 2px solid #4caf50;">
            <h4 style="color: #2e7d32; margin-bottom: 15px;">‚úÖ Ki·ªÉm tra tr·∫°ng th√°i Pairing</h4>
            <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
              Nh·∫≠p Device-Id / MAC address v√† Client-Id (optional) ƒë·ªÉ ki·ªÉm tra xem thi·∫øt b·ªã ƒë√£ ƒë∆∞·ª£c pair/activate hay ch∆∞a:
            </p>
            <div style="margin-bottom: 10px;">
              <label for="checkDeviceIdInput" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 13px;">
                Device-Id / MAC Address:
              </label>
              <input type="text" id="checkDeviceIdInput" placeholder="Nh·∫≠p Device-Id ho·∫∑c MAC address (v√≠ d·ª•: pc_192.168.1.100:54321 ho·∫∑c 6c:24:08:9e:ca:ee)" 
                     style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;" />
            </div>
            <div style="margin-bottom: 15px;">
              <label for="checkClientIdInput" style="display: block; margin-bottom: 5px; font-weight: bold; color: #333; font-size: 13px;">
                Client-Id (UUID) <span style="color: #666; font-weight: normal; font-size: 11px;">(Optional - ƒë·ªÉ tr·ªëng s·∫Ω d√πng Client-Id t·ª´ config)</span>:
              </label>
              <input type="text" id="checkClientIdInput" placeholder="Nh·∫≠p Client-Id (UUID) ho·∫∑c ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng Client-Id t·ª´ config (v√≠ d·ª•: e8c9b0b3-350f-406d-a31c-7b87be097881)" 
                     style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;" />
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
              <button onclick="checkDeviceStatus()" style="padding: 8px 20px; background-color: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; white-space: nowrap;">
                üîç Ki·ªÉm tra
              </button>
            </div>
            <div id="deviceStatusResult" style="margin-top: 10px; padding: 15px; background-color: white; border-radius: 5px; display: none;">
              <!-- K·∫øt qu·∫£ s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
            </div>
          </div>

          <!-- Section hi·ªÉn th·ªã MAC addresses ƒë√£ k·∫øt n·ªëi -->
          <div style="margin-top: 30px; padding: 20px; background-color: #f5f5f5; border-radius: 5px;">
            <h4 style="color: #4285f4; margin-bottom: 15px;">üì± Device-Id / MAC Addresses ƒë√£ k·∫øt n·ªëi</h4>
            <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
              Danh s√°ch c√°c thi·∫øt b·ªã ƒë√£ k·∫øt n·ªëi WebSocket (ESP32 ho·∫∑c PC ƒëang ch·∫°y code ESP32):<br/>
              <strong>L∆∞u √Ω:</strong> N·∫øu PC c·ªßa b·∫°n k·∫øt n·ªëi m√† kh√¥ng c√≥ MAC address, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o Device-Id t·ª´ IP address (b·∫Øt ƒë·∫ßu b·∫±ng "pc_")
            </p>
            <button onclick="loadConnectedDevices()" style="padding: 8px 15px; background-color: #0f9d58; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; margin-bottom: 15px;">
              üîÑ Refresh danh s√°ch
            </button>
            <div id="connectedDevicesList" style="margin-top: 10px;">
              <p style="color: #999; font-style: italic;">Click "Refresh" ƒë·ªÉ xem danh s√°ch MAC addresses ƒë√£ k·∫øt n·ªëi...</p>
            </div>
          </div>
        </div>
        <hr />
      </div>

      <div id="section-restart" style="display: none">
        <h3>Restart Wire-Pod</h3>
        <div>
          <p>
            Restart Wire-Pod to apply the initial setup settings immediately
          </p>
          <div id="restart"></div>
          <div>
            <button onclick="sendRestart()">Restart Wire-Pod</button>
          </div>
          <div id="restartStatus"></div>
          <hr />
        </div>
      </div>

      <div id="section-language" style="display: none">
        <h2>STT Language</h2>
        <hr class="small-hr">
        <p>Set the speech-to-text provider and language you'd like wire-pod to use.</p>
        <hr class="small-hr">
        <div id="languageStatus"></div>
        <div id="sttProviderSelectionDiv">
          <label for="sttProvider">STT Provider:</label>
          <select name="sttProvider" id="sttProvider" onchange="checkSTTProvider()">
            <option value="vosk">Vosk (Local)</option>
            <option value="whisper.cpp">Whisper.cpp (Local)</option>
            <option value="xiaozhi">Xiaozhi (Cloud)</option>
            <option value="houndify">Houndify (Cloud)</option>
          </select>
          <small class="desc" id="sttProviderDesc">Select your preferred speech-to-text provider.</small>
        </div>
        <hr class="small-hr">
        <div id="languageSelectionDiv">
          <div>
            <label for="languageSelection" id="languageLabel">Language:</label>
            <select name="languageSelection" id="languageSelection">
              <option value="en-US">English (US)</option>
              <option value="it-IT">Italian (IT)</option>
              <option value="es-ES">Spanish (ES)</option>
              <option value="fr-FR">French (FR)</option>
              <option value="de-DE">German (DE)</option>
              <option value="pt-BR">Portuguese (BR)</option>
              <option value="pl-PL">Polish (PL)</option>
              <option value="tr-TR">Turkish (TR)</option>
              <option value="ko-KR">Korean (KR)</option>
              <option value="zh-CN">Chinese (CN)</option>
              <option value="ru-RU">Russian (RU)</option>
              <option value="nt-NL">Dutch (NL)</option>
              <option value="uk-UA">Ukrainian (UA)</option>
              <option value="vi-VN">VietNamese (VN)</option>
            </select>
          </div>
          <div>
            <hr class="small-hr">
            <button onclick="setSTTLanguage()">
              Set STT Provider & Language
            </button>
          </div>
        </div>
        <hr />
      </div>
    </div>
  </div>
</body>
<script src="./js/ui.js"></script>
<script src="./js/main.js?v=2"></script>
<script src="./sdkapp/js/iro.min.js"></script>
<script src="./sdkapp/js/main.js"></script>
<script>
  updateWeatherAPI();
  updateKGAPI();
  updateSTTInfo();
</script>

</html>
